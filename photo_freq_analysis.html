<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Handwriting Letter Frequency Analysis</title>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: 20px auto; padding: 20px; line-height: 1.6; background-color: #f4f4f9; }
        .container { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        #status { font-weight: bold; color: #007bff; margin: 10px 0; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; }
        .stat-card { border: 1px solid #ddd; padding: 15px; border-radius: 5px; background: #fafafa; }
        canvas { margin-top: 20px; max-height: 400px; }
        img { max-width: 100%; height: auto; margin-top: 10px; border-radius: 5px; }
    </style>
</head>
<body>

<div class="container">
    <h2>Handwriting Frequency Analyser</h2>
    <p>Upload a clear photo of handwritten text to analyse letter frequency.</p>
    
    <input type="file" id="imageInput" accept="image/*">
    <div id="status">Ready</div>
    
    <img id="preview" src="" style="display:none;">

    <div class="stats-grid">
        <div class="stat-card">
            <strong>Total Letters:</strong> <span id="totalCount">-</span>
        </div>
        <div class="stat-card">
            <strong>Most Frequent:</strong> <span id="mostFrequent">-</span>
        </div>
    </div>

    <canvas id="frequencyChart"></canvas>
    
    <h3>Extracted Text:</h3>
    <p id="rawText" style="font-style: italic; color: #555;"></p>
</div>

<script>
    const imageInput = document.getElementById('imageInput');
    const status = document.getElementById('status');
    const totalCountEl = document.getElementById('totalCount');
    const mostFrequentEl = document.getElementById('mostFrequent');
    const rawTextEl = document.getElementById('rawText');
    const ctx = document.getElementById('frequencyChart').getContext('2d');
    let myChart;

    imageInput.addEventListener('change', async (e) => {
        const file = e.target.files[0];
        if (!file) return;

        // Reset UI
        status.innerText = "Processing image (OCR)... please wait.";
        rawTextEl.innerText = "";
        
        // Preview image
        const reader = new FileReader();
        reader.onload = (event) => {
            const img = document.getElementById('preview');
            img.src = event.target.result;
            img.style.display = 'block';
        };
        reader.readAsDataURL(file);

        // OCR Processing
        try {
            const result = await Tesseract.recognize(file, 'eng');
            const text = result.data.text;
            analyzeText(text);
            status.innerText = "Analysis Complete!";
        } catch (error) {
            status.innerText = "Error processing image.";
            console.error(error);
        }
    });

    function analyzeText(text) {
        // Clean text: lowercase and keep only a-z
        const letters = text.toLowerCase().replace(/[^a-z]/g, '').split('');
        const freq = {};
        
        letters.forEach(char => {
            freq[char] = (freq[char] || 0) + 1;
        });

        // Calculate Stats
        const sortedKeys = Object.keys(freq).sort((a, b) => freq[b] - freq[a]);
        const total = letters.length;
        
        totalCountEl.innerText = total;
        mostFrequentEl.innerText = sortedKeys.length > 0 ? `${sortedKeys[0].toUpperCase()} (${freq[sortedKeys[0]]})` : "N/A";
        rawTextEl.innerText = text;

        updateChart(freq);
    }

    function updateChart(freq) {
        const labels = 'abcdefghijklmnopqrstuvwxyz'.split('');
        const data = labels.map(l => freq[l] || 0);

        if (myChart) myChart.destroy();

        myChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels.map(l => l.toUpperCase()),
                datasets: [{
                    label: 'Letter Frequency',
                    data: data,
                    backgroundColor: 'rgba(54, 162, 235, 0.6)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } }
            }
        });
    }
</script>

</body>
</html>
