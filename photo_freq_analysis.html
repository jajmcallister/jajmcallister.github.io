<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>Handwritten Text Letter Frequency Analysis</title>
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
<style>
body { font-family: Arial, sans-serif; margin: 20px; }
#results { margin-top: 20px; }
#barChart { width: 600px; height: 300px; border: 1px solid #ccc; }
#loader { display: none; font-weight: bold; }
</style>
</head>

<body>

<h2>Handwritten Text Letter Frequency Analysis</h2>

<input type="file" accept="image/*" capture="environment" id="imageInput" />

<p id="loader">Processing imageâ€¦ please wait.</p>

<div id="extractedText"></div>

<h3>Letter Frequencies</h3>
<canvas id="barChart"></canvas>

<script>
// ---------------- Helper functions ----------------
function computeFrequencies(text) {
    const freq = {};
    for (const ch of text.toLowerCase()) {
        if (ch >= 'a' && ch <= 'z') {
            freq[ch] = (freq[ch] || 0) + 1;
        }
    }
    return freq;
}

function drawBarChart(freq) {
    const canvas = document.getElementById("barChart");
    const ctx = canvas.getContext("2d");
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    const letters = Object.keys(freq).sort();
    const counts = letters.map(l => freq[l]);
    const maxCount = Math.max(...counts, 1);

    const w = canvas.width;
    const h = canvas.height;
    const barWidth = w / letters.length;
    const scale = h / maxCount;

    letters.forEach((letter, i) => {
        const barHeight = freq[letter] * scale;
        const x = i * barWidth;
        const y = h - barHeight;
        ctx.fillStyle = "#4a90e2";
        ctx.fillRect(x, y, barWidth - 2, barHeight);

        ctx.fillStyle = "black";
        ctx.font = "12px Arial";
        ctx.fillText(letter, x + barWidth/3, h - 5);
    });
}

// ---------------- OCR + analysis ----------------
document.getElementById("imageInput").addEventListener("change", async function() {
    const file = this.files[0];
    if (!file) return;

    document.getElementById("loader").style.display = "block";
    document.getElementById("extractedText").innerHTML = "";
    const { createWorker } = Tesseract;

    const worker = createWorker({
        logger: m => console.log(m) // optional: see progress
    });

    await worker.load();
    await worker.loadLanguage('eng');
    await worker.initialize('eng');

    const { data: { text } } = await worker.recognize(file);

    await worker.terminate();

    document.getElementById("loader").style.display = "none";

    document.getElementById("extractedText").innerHTML =
        "<h3>Extracted Text:</h3><pre>" + text + "</pre>";

    const freq = computeFrequencies(text);
    drawBarChart(freq);
});
</script>

</body>
</html>
